from pydantic import validate_call

from apimatic_core.utilities.auth_helper import AuthHelper


class TestAuthHelper:

    @validate_call
    def test_base64_encoded_none_value(self):
        actual_base64_encoded_value = AuthHelper.get_base64_encoded_value()

        assert actual_base64_encoded_value is None

    @validate_call
    def test_base64_encoded_value(self):
        actual_base64_encoded_value = AuthHelper.get_base64_encoded_value('test_username', 'test_password')

        assert actual_base64_encoded_value == 'dGVzdF91c2VybmFtZTp0ZXN0X3Bhc3N3b3Jk'

    @validate_call
    def test_token_expiry(self):
        current_utc_timestamp = AuthHelper.get_current_utc_timestamp()
        actual_token_expiry_value = AuthHelper.get_token_expiry(current_utc_timestamp, 5)
        expected_token_expiry_value = current_utc_timestamp + int(5)

        assert actual_token_expiry_value == expected_token_expiry_value

    @validate_call
    def test_token_is_expired(self):
        past_timestamp = AuthHelper.get_current_utc_timestamp() - 5
        actual_token_expired = AuthHelper.is_token_expired(past_timestamp)

        assert actual_token_expired is True

    @validate_call
    def test_token_is_expired_with_clock_skew(self):
        past_timestamp = AuthHelper.get_current_utc_timestamp() + 5
        actual_token_expired = AuthHelper.is_token_expired(past_timestamp, 10)

        assert actual_token_expired is True

    @validate_call
    def test_token_is_not_expired_with_clock_skew(self):
        past_timestamp = AuthHelper.get_current_utc_timestamp() + 5
        actual_token_expired = AuthHelper.is_token_expired(past_timestamp, 3)

        assert actual_token_expired is False

        past_timestamp = AuthHelper.get_current_utc_timestamp() + 5
        actual_token_expired = AuthHelper.is_token_expired(past_timestamp, 5)

        assert actual_token_expired is False

    def test_token_is_not_expired(self):
        past_timestamp = AuthHelper.get_current_utc_timestamp() + 5
        actual_token_expired = AuthHelper.is_token_expired(past_timestamp)

        assert actual_token_expired is False



